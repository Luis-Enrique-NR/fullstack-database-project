# 5.3. Documentación de Ajustes al Modelo

Durante la transformación del Modelado Conceptual al Modelo Relacional, se identificó la necesidad de crear nuevas tablas para manejar la lógica de las relaciones, la cardinalidad, la naturaleza de los atributos, etc. Por ejemplo, para modelar la relación N a N en el modelo conceptual se representa únicamente por la relación, pero para el modelo relacional se normaliza usando una tabla emergente o intermedia que maneja este tipo de relación.

## **MÓDULO DE COMPRAS**

### Relación entre `Proveedor` e `Insumo` (N:M)

Para representar la relación N:M entre Proveedores e Insumos que ofrecen se implementa una tabla intermedia:
 
### Tabla intermedia: `InsumosXProveedores`

|**Atributo**|**Naturaleza (tipo de valor)**|**Formato**|**Clave**|**Valores válidos**|**Semántica (descripción)**|**Ontología (rol en el negocio)**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|ID\_PROVEEDOR|CHAR(5)|XX999|PK|UNIQUE, NOT NULL|Identificador único del proveedor que ofrece el insumo|	Permite identificar qué proveedor suministra el insumo|
|ID\_INSUMO|CHAR(8)|XX999  999|PK|UNIQUE, NOT NULL|Identificador único del insumo ofrecido por el proveedor|Permite conocer qué insumo está disponible para compra|
|PRECIO_REFERENCIAL|INT|99.99||NOT NULL|Precio unitario asignado por el proveedor a un insumo específico|Facilita la comparación de costos entre proveedores|

### ¿Por qué?

 - Para un mismo proveedor, este puede ofrecer mas de un insumo del mismo tipo a la empresa para abastecer su almacén.
 - Un mismo insumo puede venir de diferentes proveedores.
 - La tabla intermedia permite asociar el precio de un insumo con su proveedor, lo cual es esencial para la selección de los proveedores al momento de realizar la planificación de una compra.

## **MÓDULO DE PROCESO PRODUCTIVO**

### Relación entre `Dosificado` y `Lote de Insumo` (N:M)

Para representar la relación N:M entre Dosificados y LotesInsumo se implementa una tabla intermedia:

### Tabla intermedia: `DosificadoxLote_Insumo`

| Atributo            | Descripción                                         |
|---------------------|-----------------------------------------------------|
| ID\_DOSIFICADO    | Clave foránea que referencia a `Dosificado`         |
| ID\_LOTE\_INSUMO   | Clave foránea que referencia a `Lote de Insumo`        |
| CANTIDAD\_DOSIFICADA    | Cantidad dosificada de ese lote de insumo para un lote de producto      |

### ¿Por qué?

- Un proceso de dosificado puede requerir varios lotes de insumo debido a la formulación del producto ligado al lote de producto.
- Un mismo lote de insumo puede ser utilizado en distintos procesos de dosificado por registro histórico.
- La tabla intermedia permite asociar cuánto de cada lote fue usado por cada dosificado, lo cual es esencial para la trazabilidad del proceso productivo y el control de calidad.

## **MÓDULO DE ALMACÉN DE INSUMOS**

### Tabla intermedia: `LoteInsumoxAbastecimiento` 

Para representar la relación N:M entre LotesInsumo asignados a OrdenesAbastecimiento se implementa una tabla intermedia:

|**Atributo**|**Naturaleza (tipo de valor)**|**Formato**|**Clave**|**Valores válidos**|**Semántica (descripción)**|**Ontología (rol en el negocio)**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|ID\_ABASTECIMIENTO|CHAR|XX99999|PK|UNIQUE, NOT NULL|Identificador del abastecimiento|Facilita el seguimiento de las salidas de insumo a producción|
|ID\_LOTE_INSUMO|CHAR|XXX99999|PK|UNIQUE, NOT NULL|Identificador único del inventario |Relaciona que inventario se está asignando al abastecimiento|
|CANTIDAD\_ASIGNADA|INT|999999||NOT NULL|Cantidad asignada del insumo al abastecimiento|Permite en realizar el seguimiento y control de las cantidades asignadas a los abastecimientos |

### ¿Por qué?

- una orden de abastecimineto esta relacionado con distintos lote insumo, debido a que cada lote insumo esta relacionado solo a un lote y determinad insumo.
- Un mismo lote de insumo puede ser asignado a digerentes abastecimientos, ya que si un lote insumo tiene stock Disponible puede ser asignado a otro abastecimiento.
- La tabla intermedia permite asociar cuánto de cada lote fue usado para atender cada abastecimiento, y asi asegurar la trazabilidad en la asignacion de lote Insumo.

## **MÓDULO DE DISTRIBUCIÓN**

### Tabla intermedia: `DetallesEntrega` 

Para representar la relación N:M entre LotesProducto pertenecientes a RegistrosEntrega se implementa una tabla intermedia:

|**Atributo**|**Naturaleza (tipo de valor)**|**Formato**|**Clave**|**Valores válidos**|**Semántica (descripción)**|**Ontología (rol en el negocio)**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|ID\_REG\_ENT|SERIAL|Número secuencial|PK,FK|NOT NULL|Identificador del registro de entrega asociado|Relacionar el detalle de la entrega con el evento logístico principal|
|ID\_LOTE\_PRODUCTO|INT|Número secuencial|PK,FK|NOT NULL|Identificador del lote de producto entregado|Asociar la entrega específica al lote de producto que se despachó al cliente|
|CANT\_ENTREGADA|NUMERIC(3)|999||>0|Cantidad de unidades entregadas conforme|Registrar unidades que llegaron sin observaciones al cliente|
|CANT\_OBSERVADA|NUMERIC(3)|999||>0|Cantidad de unidades observadas o rechazadas|Registrar las unidades no conformes que podrían generar reclamos, cambios o devoluciones|
|TIPO\_INCIDENCIA|CHAR(2)|X(2)||TAB|Descripción del tipo de incidencia si existió|Registrar la razón o naturaleza de las observaciones detectadas en la entrega|

### ¿Por qué?

- Un registro de entrega puede incluir varios lotes de productos de acuerdo al pedido del cliente.
- Por un registro histórico, un lote de producto puede asignarse a diferentes entregas de acuerdo a su stock disponible.
- Además de asociar los lotes de producto con los registros de entrega, también se requiere especificar la cantidad que se ha entregado efectivamente y la cantidad que retornará al almacén por ser rechazada.

### Tabla intermedia: `PedidosDespacho` 

Para representar la relación N:M entre PedidosCliente y ProgramacionesDespacho se implementa una tabla intermedia:

|**Atributo**|**Naturaleza (tipo de valor)**|**Formato**|**Clave**|**Valores válidos**|**Semántica (descripción)**|**Ontología (rol en el negocio)**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|ID\_PROG\_DESP|INT|Número secuencial|PK, FK|UNIQUE, NOT NULL|Identificador de la programación de despacho asociada|Relacionar el pedido de cliente con la programación de despacho|
|ID\_PEDIDO\_CLIENTE|INT|Número secuencial|PK, FK|UNIQUE, NOT NULL|Identificador de la programación de despacho asociada|Relacionar el pedido solicitado por el cliente con la distribución programada|
|MOTIVO\_DESPACHO|motivo_despacho_enum|Texto|| 'Entrega', 'Reposicion' |Motivo específico del despacho|Registrar la causa o finalidad del despacho|

### ¿Por qué?

- Un pedido de cliente puede atenderse con más de un despacho dependiendo si rechaza o no los productos de la primera entrega.
- Una programación de despacho puede incluir la entrega de varios pedidos.
- Además de asociar la programación del despacho al pedido del cliente también se indica el motivo del despacho para mantener un registro histórico.

## **TABLAS GENERALES**

### Tabla: `Ubigeos` 

Para representar la información de una zona (departamento/provincia/distrito) se modela la siguiente tabla:

|**Atributo**|**Naturaleza (tipo de valor)**|**Formato**|**Clave**|**Valores válidos**|**Semántica (descripción)**|**Ontología (rol en el negocio)**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|ID\_UBIGEO|CHAR(6)|999999|PK|UNIQUE, NOT NULL|Código oficial de ubicación geográfica en Perú|Identificar de forma única un distrito en procesos de localización|
|DEPARTAMENTO|VARCHAR(50)|Texto||NOT NULL|Nombre del departamento|Permitir clasificación territorial macro para operaciones logísticas|
|PROVINCIA|VARCHAR(50)|Texto||NOT NULL|Nombre del provincia|Refinar localización intermedia para procesos de asignación de rutas|
|DISTRITO|VARCHAR(50)|Texto||NOT NULL|Nombre del distrito|Refinar localización territorial para procesos logísticos|

### ¿Por qué?

- La ubicación que requieren determinadas tablas del módulo de Distribución pueden tratarse como atributos, pero para normalizar dicha información se usarán los códigos ubigeo que representan ubicaciones por zonas. 